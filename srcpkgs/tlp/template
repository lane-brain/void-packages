# Template file for 'tlp'
pkgname=tlp
_commit=f0fbf3c3b005e4b1c2c23eef9968df72b489b2e5
_commitdate=20210103
_repourl="https://github.com/linrunner/TLP"
version=${_commitdate}
revision=1
wrksrc="TLP-${_commit}"
depends="hdparm bash iw util-linux ethtool perl"
short_desc="Advanced power management tool for Linux"
maintainer="Alan Brown <adbrown@rocketmail.com>"
license="GPL-2.0-or-later"
homepage="https://linrunner.de/en/tlp/docs/tlp-linux-advanced-power-management.html"
#changelog="https://github.com/linrunner/TLP/blob/master/changelog"
distfiles="${_repourl}/archive/${_commit}.tar.gz"
checksum=8ca6d78551a4041d1aabfcc2a13a465a4c00725a7887b4079bc739b9426a3873

conflicts="laptop-mode>=0"
conf_files="/etc/tlp.conf /etc/tlp.d/*.conf"

do_install() {
	make DESTDIR=${DESTDIR} \
		TLP_SBIN=/usr/bin \
		TLP_ULIB=/usr/lib/udev \
		TLP_SHCPL=/usr/share/bash-completion/completions \
		TLP_ELOD=/usr/libexec/elogind/system-sleep \
		TLP_WITH_SYSTEMD=0 \
		install

	vmkdir usr/share/man/man1
	install -m644 man/*.1 ${DESTDIR}/usr/share/man/man1
	vmkdir usr/share/man/man8
	install -m644 man/*.8 ${DESTDIR}/usr/share/man/man8
	install -m644 man-rdw/*.8 ${DESTDIR}/usr/share/man/man8
	rm -f ${DESTDIR}/usr/share/man/man8/*.service.8

	vsv tlp

	rm -rf ${DESTDIR}/etc/init.d
}

tlp-rdw_package() {
	short_desc="Control the radio device wizard"
	depends="tlp NetworkManager"
	pkg_install() {
		vmove usr/bin/tlp-rdw
		vmove usr/lib/udev/rules.d/85-tlp-rdw.rules
		vmove usr/lib/udev/tlp-rdw-udev
		vmove etc/NetworkManager/dispatcher.d/99tlp-rdw-nm
		vmove usr/share/man/man8/tlp-rdw.8
	}
}
